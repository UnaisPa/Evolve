<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.css">
<style>
    .detailDiv {
        display: flex;
        justify-content: center;
        padding-left: 10px;
    }

    .shipAddress {
        border: 1px solid rgb(160, 158, 158);
        border-radius: 10px;
    }
</style>
<link rel="stylesheet" href="/stylesheet/assets/css/all.min.css">
<!-- bootstrap -->
<link rel="stylesheet" href="/stylesheet/assets/bootstrap/css/bootstrap.min.css">
<!-- owl carousel -->
<link rel="stylesheet" href="/stylesheet/assets/css/owl.carousel.css">
<!-- magnific popup -->
<link rel="stylesheet" href="/stylesheet/assets/css/magnific-popup.css">
<!-- animate css -->
<link rel="stylesheet" href="/stylesheet/assets/css/animate.css">
<!-- mean menu css -->
<link rel="stylesheet" href="/stylesheet/assets/css/meanmenu.min.css">
<!-- main style -->
<link rel="stylesheet" href="/stylesheet/assets/css/main.css">
<!-- responsive -->
<link rel="stylesheet" href="/stylesheet/assets/css/responsive.css">
{{!-- sweet alert --}}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.css">


 <!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->

    <!-- header -->
    <div class="top-header-area" id="sticker">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-sm-12 text-center">
                    <div class="main-menu-wrap">
                        <!-- logo -->
                        <div class="site-logo">
                            <a href="/home">
                                <h3 style="color: #F28123;margin-top: 9px;">Evolve.</h3>
                                {{!-- <img src="stylesheet/assets/img/logo.png" alt=""> --}}
                            </a>
                        </div>
                        <!-- logo -->

                        <!-- menu start -->
                        <nav class="main-menu">
                            <ul>
                                <li ><a href="/home">Home</a></li>
                                <li ><a href="/shop">Shop</a></li>
                                {{#if verified}}<li class="current-list-item"><a  href="/profile">Profile</a></li>
                                {{else}}<li><a href="/login">Login</a></li>{{/if}}
                                <li><a href="/contact">Contact</a></li>
                                <li><a href="/wishlist">Wishlist</a></li>
                                {{!-- <li><a href="shop.html">Shop</a>
                                    <ul class="sub-menu">
                                        <li><a href="shop.html">Shop</a></li>
                                        <li><a href="checkout.html">Check Out</a></li>
                                        <li><a href="single-product.html">Single Product</a></li>
                                        <li><a href="cart.html">Cart</a></li>
                                    </ul>
                                </li> --}}

                                <li>
                                    <div class="header-icons">
                                        <a class="shopping-cart" href="/cart"><i class="fas fa-shopping-cart"></i></a>
                                        <a>
                                            <form action="/shop" method="get" style="margin-right:2%;">
                                                <div style="" class="input-group">
                                                    <input id="searchBar" name="search"
                                                        style="width: 130px;height: 40px;" class="form-control"
                                                        aria-describedby="button-addon2" placeholder="Search" {{#if
                                                        search}} value="{{search}}" {{/if}}>
                                                    <button
                                                        style="border-color: rgb(223, 216, 216); border-left: white; background-color: white;"
                                                        class="btn " type="submit" id="button-addon2"><i id="searchbtn"
                                                            style="font-size: 20px;" class='bx bx-search'></i></button>
                                                </div>
                                            </form>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </nav>
                        <div class="mobile-menu"></div>
                        <!-- menu end -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end header -->

    <!-- search area -->
    <div class="search-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <span class="close-btn"><i class="fas fa-window-close"></i></span>
                    <div class="search-bar">
                        <div class="search-bar-tablecell">
                            <h3>Search For:</h3>
                            <input type="text" placeholder="Keywords">
                            <button type="submit">Search <i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end search area -->

{{!-- <section class="banner-section border-top border-bottom">
    <div class="text-center">
        <h2 style="padding-top:100px;">Shop</h2>
    </div>
</section> --}}
<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						
						<h1 style="font-weight: 700;">Order Details</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->
<section class="container mt-5 mb-5">
    <div class="header-sec text-center">
        <h3>Order Details</h3>
        <p {{#each orderDetails}}{{#eq this.orderStatus "Placed" }}style="color:blue;" {{/eq}}{{/each}}
         {{#each orderDetails}}{{#eq this.orderStatus "Delivered" }}style="color:green;" {{/eq}}{{/each}} 
         {{#each orderDetails}}{{#eq this.orderStatus "Cancel" }}style="color:red;" {{/eq}}{{/each}}>Your order {{#each orderDetails}}{{#eq this.returnOrderStatus 'request approved'}}request approved{{/eq}}{{#eq this.returnOrderStatus 'requested'}}Return {{this.returnOrderStatus}}{{else}}{{this.orderStatus}}{{/eq}}{{/each}}</p>
         {{!-- <p class="text-danger">{{#each orderDetails}}{{#eq this.returnOrderStatus 'requested'}}Return request sent{{/eq}}{{/each}}</p> --}}
    </div>
    <div class="row mt-5">
        <div class="col-md-4 shipAddress">
            <h6 class="text-center mt-3">Order Info</h6>
            <div>
                <div class="detailDiv text-secondary">
                    <div class=" col-6" style="float: right;">
                        <p style="font-size: 16px;font-family: poppins;">Order Number </p>
                        <p style="font-size: 16px;font-family: poppins;">Date </p>
                        <p style="font-size: 16px;font-family: poppins;">Discount </p>
                        <p style="font-size: 16px;font-family: poppins;">Total </p>
                        <P style="font-size: 16px;font-family: poppins;">Order Status</P>
                        <p style="font-size: 16px;font-family: poppins;">Payment Method</p>
                    </div>
                    <div class=" col-6">
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.order}}{{/each}}</p>
                        <p style="font-size: 14px;font-family: poppins;">: {{orderDate}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: Rs.{{#each orderDetails}}{{this.discount}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: Rs.{{#each orderDetails}}{{this.totalAmount}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.orderStatus}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.paymentMethod}}{{/each}}</p>
                    </div>
                </div>
                <hr>
                <input type="hidden" id="orderId" value="{{#each orderDetails}}{{this._id}}{{/each}}">
                {{!-- <p{{#each orderDetails}}{{#eq this.orderStatus "Delivered" }}style="display:none"{{/eq}}{{#eq this.orderStatus "Cancel" }}style="display:none"{{/eq}}{{/each}}>Order Cancellation Option Available</p><br> --}}
                <button {{#each orderDetails}}{{#eq this.orderStatus "Delivered"}}style="display:none"{{/eq}}{{#eq this.orderStatus "Cancel" }}style="display:none"{{else}}{{/eq}}{{/each}} id="cancelBtn" class="btn btn-danger mb-2">Cancel Order</button>
                
                
            </div>
        </div>
        <div class="col-md-4  shipAddress">
            <h6 class="text-center mt-3">Shipping Address</h6>
            <div>
                <div class="detailDiv  text-secondary">
                    <div class=" col-6" style="float: right;">
                        <p style="font-size: 16px;font-family: poppins;">Name</p>
                        <p style="font-size: 16px;font-family: poppins;">Mobile </p>
                        <p style="font-size: 16px;font-family: poppins;">City </p>
                        <P style="font-size: 16px;font-family: poppins;">Pincode</P>
                        <p style="font-size: 16px;font-family: poppins;">District</p>
                        <p style="font-size: 16px;font-family: poppins;">State</p>
                        <p style="font-size: 16px;font-family: poppins;">Address</p>
                    </div>
                    <div class=" col-6">
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.address.name}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.address.mobile}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.address.city}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.address.pincode}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.address.district}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.address.state}}{{/each}}</p>
                        <p style="font-size: 16px;font-family: poppins;">: {{#each orderDetails}}{{this.address.address}}{{/each}}</p>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-md-4 shipAddress">
            <h6 class="text-center mt-3">Ordered Products</h6>
            <div class="text-secondary">
                <table class="table table-borderless ">
                    <thead>
                        <tr>
                            <td style="font-size: 16px;font-family: poppins;">Products</td>
                            <td style="font-size: 16px;font-family: poppins;">Qty</td>
                            <td style="font-size: 16px;font-family: poppins;">Total</td>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each products}}
                        <tr>
                            <td style="font-size: 16px;font-family: poppins;">{{this.productId.name}}</td>
                            <td style="font-size: 16px;font-family: poppins;">{{this.quantity}}</td>
                            <td style="font-size: 16px;font-family: poppins;">{{this.total}}</td>
                        </tr>
                        {{/each}}
                        <tr>
                            <td>Discount</td>
                            <td style="font-size: 16px;font-family: poppins;">₹{{#each orderDetails}}{{discount}}{{/each}} </td>
                        </tr>
                    </tbody>
                </table>
                <div class="d-flex m-2">
                    <h5 class="mx-2">Total : </h5>
                    <h5>₹ {{#each orderDetails}}{{totalAmount}}{{/each}} Rs</h5>
                </div>
                
            </div>
        </div>
    </div>
    <div class="text-center mt-3">
        {{#each orderDetails}}{{#eq this.returnOrderStatus 'requested'}}{{/eq}}{{#eq this.returnOrderStatus 'request approved'}}{{else}}
    {{#eq this.orderStatus "Delivered" }}<button id="returnBtn"  type="button" class="btn btn-danger">Return</button>{{/eq}}{{/eq}}{{/each}}

    <a href="/invoice/{{#each orderDetails}}{{this._id}}{{/each}}" class="btn btn-info"
            style="color: white;">DOWNLOAD INVOICE</a>
    </div>
</section>
    <!-- footer -->
    <div class="footer-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box about-widget">
                        <h2 class="widget-title">About us</h2>
                        <p>Evolve: Elevate your space with curated home decor and furniture. Explore a blend of style and innovation for a sophisticated living experience.</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box get-in-touch">
                        <h2 class="widget-title">Get in Touch</h2>
                        <ul>
                            <li> GK Building , Bangalore 432</li>
                            <li>support@evolve.com</li>
                            <li>+91 667 8822 0909</li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box pages">
                        <h2 class="widget-title">Explore</h2>
                        <ul>
                            <li><a href="/home">Home</a></li>
                            <li><a href="/about">About</a></li>
                            <li><a href="/shop">Shop</a></li>
                            <li><a href="/contact">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-box subscribe">
                        <h2 class="widget-title">Subscribe</h2>
                        <p>Subscribe to our mailing list to get the latest updates.</p>
                        <form action="">
                            <input type="email" placeholder="Email">
                            <button type="submit"><i class="fas fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end footer -->

    <!-- copyright -->
    <div class="copyright">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-12">
                    <p>Copyrights &copy; 2023 - <a href="/home">Evolve</a>, All Rights
                        Reserved.</p>
                </div>
                <div class="col-lg-6 text-right col-md-12">
                    <div class="social-icons">
                        <ul>
                            <li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end copyright -->

    <!-- jquery -->
    <script src="/stylesheet/assets/js/jquery-1.11.3.min.js"></script>
    <!-- bootstrap -->
    <script src="/stylesheet/assets/bootstrap/js/bootstrap.min.js"></script>
    <!-- count down -->
    <script src="/stylesheet/assets/js/jquery.countdown.js"></script>
    <!-- isotope -->
    <script src="/stylesheet/assets/js/jquery.isotope-3.0.6.min.js"></script>
    <!-- waypoints -->
    <script src="/stylesheet/assets/js/waypoints.js"></script>
    <!-- owl carousel -->
    <script src="/stylesheet/assets/js/owl.carousel.min.js"></script>
    <!-- magnific popup -->
    <script src="/stylesheet/assets/js/jquery.magnific-popup.min.js"></script>
    <!-- mean menu -->
    <script src="/stylesheet/assets/js/jquery.meanmenu.min.js"></script>
    <!-- sticker js -->
    <script src="/stylesheet/assets/js/sticker.js"></script>
    <!-- main js -->
    <script src="/stylesheet/assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const cancelBtn = document.getElementById('cancelBtn');
    cancelBtn.addEventListener('click', (e) => {
        e.preventDefault()
        const response = Swal.fire({
            title: "Are you Sure ",
            text: "To Cancel This Order",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#990f0f',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No !'
        }).then((result) => {
            if (result.isConfirmed) {
                const orderId = document.getElementById('orderId').value
                $.ajax({
                    type: "GET",
                    url: `/cancel_order/${orderId}`, // Your server route for adding items to the cart
                    success: function (data) {
                        if (data.status == 'success') {
                            Swal.fire({
                                icon: 'success',
                                title: data.message,
                                showConfirmButton: false,
                                timer: 2000
                            })
                            setTimeout(() => {
                                location.reload()
                            }, 2000)
                        } else if (data.status == 'warning') {
                            Swal.fire({
                                icon: 'warning',
                                title: data.message,
                                showConfirmButton: false,
                                timer: 2000
                            })
                        }
                        else {
                            Swal.fire({
                                icon: 'error',
                                title: result.message,
                                showConfirmButton: false,
                                timer: 1500
                            })
                        }

                    },
                    error: function (error) {
                        Swal.fire({
                            icon: 'error',
                            title: result.message,
                            showConfirmButton: false,
                            timer: 1500
                        })
                        console.error(error);
                    }
                })
            }
        })
    })

    const returnBtn = document.getElementById('returnBtn');
    returnBtn.addEventListener('click', (e) => {
        e.preventDefault()
        const response = Swal.fire({
            title: "Are you Sure ",
            text: "To Return This Order",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#990f0f',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No !'
        }).then((result) => {
            if (result.isConfirmed) {
                const orderId = document.getElementById('orderId').value
                $.ajax({
                    type: "POST",
                    url: `/return_order/${orderId}`, // Your server route for adding items to the cart
                    success: function (data) {
                        if (data.status == 'success') {
                            Swal.fire({
                                icon: 'success',
                                title: data.message,
                                showConfirmButton: false,
                                timer: 2000
                            })
                            setTimeout(() => {
                                location.reload()
                            }, 2000)
                        } else if (data.status == 'warning') {
                            Swal.fire({
                                icon: 'warning',
                                title: data.message,
                                showConfirmButton: false,
                                timer: 2000
                            })
                        }
                        else {
                            Swal.fire({
                                icon: 'error',
                                title: result.message,
                                showConfirmButton: false,
                                timer: 1500
                            })
                        }

                    },
                    error: function (error) {
                        Swal.fire({
                            icon: 'error',
                            title: result.message,
                            showConfirmButton: false,
                            timer: 1500
                        })
                        console.error(error);
                    }
                })
            }
        })
    })


</script>